(function(){"use strict";var t={2697:function(t,e,a){var o=a(6369),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("HomeView")],1)},s=[],n=function(){var t=this,e=t._self._c;return e("BaseLayout",[t.loading?e("div",{staticClass:"progress convert-progress"},[e("div",{staticClass:"progress-bar",class:{"bg-success":100==t.percentage},style:{width:t.percentage+"%"},attrs:{role:"progressbar","aria-valuenow":t.percentage,"aria-valuemin":"0","aria-valuemax":"100"}})]):t._e(),e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-12 col-md-6"},[e("h3",{staticClass:"text-center"},[t._v("Bulk SquareFit")]),e("div",{staticClass:"card my-3"},[e("div",{staticClass:"card-header"},[e("h5",{staticClass:"card-title m-0"},[t._v("Select Images")])]),e("div",{staticClass:"card-body"},[e("div",[e("input",{ref:"images",staticClass:"form-control",attrs:{type:"file",id:"images-input",accept:"image/*",multiple:""},on:{change:t.onChange}}),e("div",{staticClass:"mt-2"},[e("p",{staticClass:"mb-2"},[e("strong",[t._v("Background")])]),e("div",{staticClass:"form-check"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.background.option,expression:"background.option"}],staticClass:"form-check-input",attrs:{type:"radio",name:"background_opt",id:"background-opt-2",value:"automatic"},domProps:{checked:t._q(t.background.option,"automatic")},on:{change:function(e){return t.$set(t.background,"option","automatic")}}}),e("label",{staticClass:"form-check-label",attrs:{for:"background-opt-2"}},[t._v(" Automatic color "),e("br"),e("span",{staticClass:"text-muted small"},[t._v("Sets background color automatically")])])]),e("div",{staticClass:"form-check"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.background.option,expression:"background.option"}],staticClass:"form-check-input",attrs:{type:"radio",name:"background_opt",id:"background-opt-1",value:"custom"},domProps:{checked:t._q(t.background.option,"custom")},on:{change:function(e){return t.$set(t.background,"option","custom")}}}),e("label",{staticClass:"form-check-label",attrs:{for:"background-opt-1"}},[t._v(" Custom color "),e("div",{staticClass:"mt-2 d-flex align-items-center"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.background.selected,expression:"background.selected"}],attrs:{type:"color",id:"background-color",disabled:"custom"!=t.background.option},domProps:{value:t.background.selected},on:{input:function(e){e.target.composing||t.$set(t.background,"selected",e.target.value)}}})])])]),e("div",{staticClass:"form-check"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.background.option,expression:"background.option"}],staticClass:"form-check-input",attrs:{type:"radio",name:"background_opt",id:"background-opt-3",value:"blur"},domProps:{checked:t._q(t.background.option,"blur")},on:{change:function(e){return t.$set(t.background,"option","blur")}}}),e("label",{staticClass:"form-check-label",attrs:{for:"background-opt-3"}},[t._v(" Blurred "),e("br"),e("span",{staticClass:"text-muted small"},[t._v("Source image blurred in background")]),e("div",[e("label",{staticClass:"form-label",attrs:{for:"blur-radius"}},[t._v("Blur radius")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.background.radius,expression:"background.radius"}],staticClass:"form-range",attrs:{type:"range",id:"blur-radius",min:"1",max:"50",disabled:"blur"!=t.background.option},domProps:{value:t.background.radius},on:{__r:function(e){return t.$set(t.background,"radius",e.target.value)}}})])])])])]),t.fileList.length>0?[e("hr"),e("div",{staticClass:"text-muted mb-2"},[t._v("Preview")]),e("div",{staticClass:"row align-items-center"},t._l(t.fileList,(function(t,a){return e("div",{key:a,staticClass:"col-3 border text-center p-0"},[e("img",{staticClass:"img-fluid",staticStyle:{height:"100px","object-fit":"contain"},attrs:{src:t,alt:""}})])})),0)]:t._e()],2),e("div",{staticClass:"card-footer"},[e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.loading},on:{click:t.onSubmit}},[t._v("Square Fit'em")])])]),t.completed.length>0?[e("h5",[t._v("Completed")]),e("ul",{staticClass:"list-group mb-3"},t._l(t.completed,(function(a,o){return e("li",{key:o,staticClass:"list-group-item d-flex justify-content-between align-items-center"},[e("img",{staticClass:"border",staticStyle:{height:"50px",width:"50px","object-fit":"cover"},attrs:{src:a.url,alt:""}}),e("button",{staticClass:"btn btn-link",on:{click:function(e){return t.previewImage(o)}}},[t._v("Preview")]),e("button",{staticClass:"btn btn-sm btn-outline-success",on:{click:function(e){return t.downloadImage(o)}}},[t._v("Download "+t._s(a.downloaded?"again":""))])])})),0),e("button",{staticClass:"btn btn-primary d-block mx-auto mb-2",on:{click:function(e){return t.bulkDownload()}}},[t._v("Download all")]),t.completed.some((t=>t.downloaded))&&t.completed.filter((t=>t.downloaded)).length!=t.completed.length?e("button",{staticClass:"btn btn-outline-primary d-block mx-auto",on:{click:function(e){return t.bulkDownload(!1)}}},[t._v("Download remaining")]):t._e()]:t._e(),t.errors?e("ul",{staticClass:"list-group list-group-flush"},t._l(t.errors,(function(a,o){return e("li",{key:o,staticClass:"list-group-item text-danger"},[t._v(t._s(o+1)+") "+t._s(a))])})),0):t._e()],2),e("div",{staticClass:"modal fade",attrs:{id:"imagePreviewModal",tabindex:"-1","aria-labelledby":"imagePreviewModalLabel","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog modal-dialog-centered"},[null!=t.previewIndex?e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"imagePreviewModalLabel"}},[t._v("Image Preview")]),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})]),e("div",{staticClass:"modal-body"},[e("img",{staticClass:"img-fluid border",attrs:{src:t.completed[t.previewIndex].url,alt:""}})]),e("div",{staticClass:"modal-footer justify-content-center"},[e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return t.downloadImage(t.previewIndex)}}},[t._v("Download "+t._s(t.completed[t.previewIndex].downloaded?"again":""))])])]):t._e()])])])])},r=[],l=(a(8675),a(7380),a(1118),a(1703),function(){var t=this,e=t._self._c;return e("div",{staticClass:"container py-3"},[t._t("default")],2)}),c=[],d=a(1001),u={},m=(0,d.Z)(u,l,c,!1,null,null,null),g=m.exports,h={name:"HomeView",components:{BaseLayout:g},data(){return{loading:!1,errors:[],fileList:[],previewIndex:null,background:{option:"automatic",selected:"#ffffff",radius:8},progress:{total:0,loaded:0},dim:2048,ctx:null,completed:[],suffix:(new Date).getTime().toString(32)}},computed:{percentage(){return 100*this.progress.loaded/(this.progress.total||1)}},watch:{"progress.loaded":function(t,e){t==this.progress.total&&setTimeout((()=>{this.loading=!1,this.removeSelectedFiles()}),1e3)}},methods:{onChange(t){this.fileList=[];for(let e of t.target.files)this.fileList.push(URL.createObjectURL(e))},removeSelectedFiles(){const t=this.$refs.images;t.value=null,this.onChange({target:t})},addToCompleted(t){this.completed.push({url:t,downloaded:!1})},previewImage(t){this.previewIndex=t,new window.bootstrap.Modal(document.getElementById("imagePreviewModal")).show()},downloadImage(t){const e=this.completed[t];var a=document.createElement("a");a.href=e.url,a.download=`SquareFit ${this.suffix} ${t+1}.jpeg`,document.body.appendChild(a),a.click(),a.remove(),e.downloaded=!0},bulkDownload(t=!0){this.completed.forEach(((e,a)=>{!t&&e.downloaded||this.downloadImage(a)}))},componentToHex(t){var e=t.toString(16);return 1==e.length?"0"+e:e},rgbToHex(t,e,a){return"#"+this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(a)},getAutomaticColor(t){const e=document.createElement("canvas");e.height=t.height,e.width=t.width;const a=e.getContext("2d");a.drawImage(t,0,0);const o={};if(t.height>t.width){const e=new Uint8ClampedArray([...a.getImageData(0,0,1,t.height).data,...a.getImageData(t.width-1,0,1,t.height).data]);for(let a=0;a<4*t.height*2;a+=4){const t=this.rgbToHex(e[a],e[a+1],e[a+2]);o[t]=(o[t]??0)+1}}else{const e=new Uint8ClampedArray([...a.getImageData(0,0,t.width,1).data,...a.getImageData(0,t.height-1,t.width,1).data]);for(let a=0;a<4*t.width*2;a+=4){const t=this.rgbToHex(e[a],e[a+1],e[a+2]);o[t]=(o[t]??0)+1}}let i,s=-1;console.log(o);for(let[n,r]of Object.entries(o))r>s&&(i=n,s=r);return i},handleOnline(t,e){let a=new FormData;a.append("image",t),fetch(`?${e.toString()}`,{method:"POST",body:a}).then((t=>{if(t.ok)return t.blob();throw new Error(t.statusText)})).then((t=>{var e=window.URL.createObjectURL(t);this.addToCompleted(e)})).catch((t=>{this.errors.push(t.message)})).then((()=>{this.progress.loaded++}))},handleOffline(t){const e=new FileReader;e.addEventListener("load",(()=>{const t=new Image;t.src=e.result,t.onload=()=>{let e=this.background.selected;["automatic","blur"].includes(this.background.option)&&(e=this.getAutomaticColor(t));const a=t.height,o=t.width;if(this.ctx.beginPath(),this.ctx.rect(0,0,this.dim,this.dim),"blur"===this.background.option){let i,s;this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.filter=`blur(${this.background.radius}px)`,o>a?(i=o*(this.dim/a),s=this.dim,this.ctx.drawImage(t,(this.dim-i)/2,0,i,s)):(s=a*(this.dim/o),i=this.dim,this.ctx.drawImage(t,0,(this.dim-s)/2,i,s)),this.ctx.filter="blur(0px)"}else this.ctx.fillStyle=e,this.ctx.fill();let i,s,n=0,r=0;a>o?(i=o/(a/this.dim),s=this.dim,n=(this.dim-i)/2,r=0):(s=a/(o/this.dim),i=this.dim,n=0,r=(this.dim-s)/2),this.ctx.drawImage(t,n,r,i,s),this.progress.loaded++,this.addToCompleted(this.ctx.canvas.toDataURL("image/jpeg"))}}),!1),e.readAsDataURL(t)},onSubmit(){if(this.$refs.images?.files?.length){this.loading=!0,this.progress.loaded=0,this.progress.total=this.$refs.images.files.length;for(let t of this.$refs.images.files)this.handleOffline(t)}else alert("Add images!")}},mounted(){const t=document.createElement("canvas");t.height=this.dim,t.width=this.dim,this.ctx=t.getContext("2d")}},p=h,f=(0,d.Z)(p,n,r,!1,null,null,null),b=f.exports,v={name:"App",components:{HomeView:b}},w=v,k=(0,d.Z)(w,i,s,!1,null,null,null),C=k.exports;o.ZP.config.productionTip=!1,new o.ZP({render:t=>t(C)}).$mount("#app")}},e={};function a(o){var i=e[o];if(void 0!==i)return i.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,a),s.exports}a.m=t,function(){var t=[];a.O=function(e,o,i,s){if(!o){var n=1/0;for(d=0;d<t.length;d++){o=t[d][0],i=t[d][1],s=t[d][2];for(var r=!0,l=0;l<o.length;l++)(!1&s||n>=s)&&Object.keys(a.O).every((function(t){return a.O[t](o[l])}))?o.splice(l--,1):(r=!1,s<n&&(n=s));if(r){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[o,i,s]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={826:0};a.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,s,n=o[0],r=o[1],l=o[2],c=0;if(n.some((function(e){return 0!==t[e]}))){for(i in r)a.o(r,i)&&(a.m[i]=r[i]);if(l)var d=l(a)}for(e&&e(o);c<n.length;c++)s=n[c],a.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return a.O(d)},o=self["webpackChunkbulk_squarefit"]=self["webpackChunkbulk_squarefit"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998],(function(){return a(2697)}));o=a.O(o)})();
//# sourceMappingURL=index.00d9dc33.js.map